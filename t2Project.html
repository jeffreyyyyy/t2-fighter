<!DOCTYPE html>

<html>

<style>
canvas {
	border:2px solid red;
}
</style>

<body>
<canvas id="canvasID" width=1200 height=500></canvas>
<script>
	var canvas = document.getElementById("canvasID");
	var context = canvas.getContext("2d");
	var stateController = 0;
	var hh = 100;
	var ww = 100;
	var loadPhoto = new Image();
	var playerL = null;
	var playerR = null;
	var lX = 100;
	var rX = canvas.width-200;
	loadPhoto.width = ww;
	loadPhoto.height = hh;
	loadPhoto.src = "./fighter-stuff/kai.png";
	var samokai = new Image();
	var background = new Image();
	background.src = "./fighter-stuff/background.jpg";
	samokai.src = "./fighter-stuff/kai.png";
	document.addEventListener("keydown", affirmKeyDown);
	
	
	setInterval(controlState,33);
	
	function controlState(){
		if(stateController == 0){
			startScreen();
			if(ww <= 300){
				bigImage();
			}
			else{
				showText();
			}
		}
		else if(stateController == 1){
			characterSelectL();
			canvas.addEventListener("click",handleClickL);
		}
		else if(stateController == 2){
			characterSelectR();
			canvas.addEventListener("click",handleClickR);
		}
		else if(stateController == 3){
			playGame();
			document.addEventListener("keydown", gameKeyPressed);
			document.addEventListener("keyup", gameKeyReleased);
		}
	}
	
	function affirmKeyDown(event){
		stateController++;
		document.removeEventListener("keydown",affirmKeyDown);
		console.log("peen");
	}
	
	function startScreen(){
		context.drawImage(loadPhoto, (canvas.width/2-ww/2), (canvas.height/2-hh/2), hh, ww);
	}
	
	function bigImage(){
		hh++;
		ww++;
	}
	
	function showText(){
		context.font = "50px Arial";
		context.fillText("SAMO SHOWDOWN", canvas.width/2-250, canvas.height/2 + canvas.height/3 + 25);
		context.font = "20px Arial";
		context.fillText("Press any key to continue.", canvas.width/2-250, canvas.height/2 + canvas.height/3 + 50);
	}
	
	function characterSelectL(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.font = "30px Arial";
		context.fillText("CHARACTER SELECT (P1)", canvas.width/2-175, 50);
		context.drawImage(samokai, 50,100,150,150);
		context.fillText("SAMOKAI", 50, 100+150+30);
	}
	
	function characterSelectR(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.font = "30px Arial";
		context.fillText("CHARACTER SELECT (P2)", canvas.width/2-175, 50);
		context.drawImage(samokai, 50,100,150,150);
		context.fillText("SAMOKAI", 50, 100+150+30);
	}
	
	function handleClickL(event){
		console.log(event.x);
		if(event.x>50 && event.x <210){
			selectKaiL();
		}
	}	
	
	function handleClickR(event){
		console.log(event.x);
		if(event.x>50 && event.x <210){
			selectKaiR();
		}	
	}
	
	function selectKaiL(){
		playerL = new LeftSamokai();
		console.log(playerL);
		canvas.removeEventListener("click", handleClickL);
		stateController++;
	}
	
	function selectKaiR(){
		playerR = new RightSamokai();
		console.log(playerR);
		canvas.removeEventListener("click", handleClickR);
		stateController++;
	}
	
	
	function drawBackground(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.drawImage(background, 0 ,0 ,1200,600);
	}
	
	function playGame(){
		drawBackground();
		drawCharacters();
				
	}
	
	function gameKeyPressed(event){
		if(event.key == 'w' || (event.key == 'a' && playerL.movingLeft == false)|| event.key == 's' || (event.key == 'd' && playerL.movingRight == false)){
			playerL.checkMove(event);
			if((event.key == 'a' && playerL.movingLeft == false)|| (event.key == 'd' && playerL.movingRight == false)){
			console.log("checks key up");
			}
		}
		if(event.keyCode>=37 && event.keyCode <= 40){
			playerR.checkMove(event);
		}
			
			
	}
	
	function gameKeyReleased(event){
		if(event.key == 'w' || (event.key == 'a' && playerL.movingLeft == true)|| event.key == 's' || (event.key == 'd' && playerL.movingRight == true)){
			playerL.stopMove(event);
		}
		if(event.keyCode>=37 && event.keyCode <= 40){
			playerR.stopMove(event);
		}
	}
	
	
	function drawCharacters(){
		if(playerL.name == samokai){
			playerL.draw();
			playerL.move();
		}
		if(playerR.name == samokai){
			playerR.draw();
			playerR.move();
		}
	}
	
	function RightSamokai(){
		this.name = samokai;
		this.x = 1000;
		this.y = 100;
		this.movingRight = false;
		this.movingLeft = false;
		this.speed = 9;
		this.walking = new Image();
		this.walking.src = "./fighter-stuff/normalSamo_walking_sprite.png";
		this.totalImagesWalking = 4;
		this.currentImagePos = 0;
		this.subImageHeight = 100;
		this.subImageWidth = 100;
		
		this.draw = function(){
			context.drawImage(samokai, this.x, this.y, 100, 200);
		//	console.log('bemis');
		}
		
		this.move = function(){
			if(this.movingRight == true){
				this.x += this.speed;
				console.log('moving r');
			}
			if(this.movingLeft == true){
				this.x -= this.speed;
			}
		}
		
		this.checkMove = function(event){
			if(event.keyCode == 37 && this.movingLeft == false){
				this.movingLeft = true;
				console.log("left start");
				//document.removeEventListener
				
			}
			if(event.keyCode == 39 && this.movingRight == false){
				this.movingRight = true;
				console.log("right start");
				//console.log(this.x);
			}
			if(event.key == 'w'){
				//playerLJump();
			}
			if(event.key == 's'){
				//playerLBlock();
			}
		}
		
	
	
		this.stopMove = function(event){
			if(event.keyCode == 37 && this.movingLeft == true){
				this.movingLeft = false;
				console.log("left stop @ " + this.x);
			}
			if(event.keyCode == 39 && this.movingRight == true){
				this.movingRight = false;
				console.log("right stop @ " + this.x);
			}
		}
	}
	
	function LeftSamokai(){
		this.name = samokai;
		this.x = 100;
		this.y = 100;
		this.movingRight = false;
		this.movingLeft = false;
		this.speed = 9;
		this.walking = new Image();
		this.walking.src = "./fighter-stuff/normalSamo_walking_sprite.png";
		this.totalImagesWalking = 4;
		this.currentImagePos = 0;
		this.subImageHeight = 100;
		this.subImageWidth = 100;
		
		this.draw = function(){
			context.drawImage(samokai, this.x, this.y, 100, 200);
		//	console.log('bemis');
		}
		
		this.move = function(){
			if(this.movingRight == true){
				this.x += this.speed;
				console.log('moving r');
			}
			if(this.movingLeft == true){
				this.x -= this.speed;
			}
		}
		
		this.checkMove = function(event){
			if(event.key == 'a' && this.movingLeft == false){
				this.movingLeft = true;
				console.log("left start");
				//document.removeEventListener
				
			}
			if(event.key == 'd' && this.movingRight == false){
				this.movingRight = true;
				console.log("right start");
				console.log(this.x);
			}
			if(event.key == 'w'){
				//playerLJump();
			}
			if(event.key == 's'){
				//playerLBlock();
			}
		}
		
	
	
	this.stopMove = function(event){
		if(event.key == 'a' && this.movingLeft == true){
			this.movingLeft = false;
			console.log("left stop @ " + this.x);
		}
		if(event.key == 'd' && this.movingRight == true){
			this.movingRight = false;
			console.log("right stop @ " + this.x);
		}
	}
		
		
		}
	
	
</script>